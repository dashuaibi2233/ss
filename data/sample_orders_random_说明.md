# sample_orders_random.csv 说明文档

## 文件用途

这是一个专门用于测试**订单随机到达**和**滚动调度**机制的测试数据集。

## 列说明

| 列名 | 类型 | 说明 | 示例 |
|------|------|------|------|
| `order_id` | int | 订单编号（唯一标识） | 1, 2, 3... |
| `product` | int | 产品类型（1/2/3） | 1=产品1, 2=产品2, 3=产品3 |
| `quantity` | int | 订单需求数量 | 80-300单位 |
| `release_slot` | int | **订单到达时间**（slot索引，1-based）<br>订单在此时间之后才能被调度 | 3表示第1天的slot 3 |
| `due_slot` | int | 订单截止时间（slot索引，1-based）<br>必须在此时间前完成，否则罚款 | 35表示第6天的slot 5 |
| `unit_price` | float | 单位售价（元/单位） | 45-70元 |

## 数据特征

### 基本信息
- **订单总数**: 20个
- **产品种类**: 3种
- **时间跨度**: 订单在前10天内随机到达

### 到达分布

订单不是在第1天一次性给出，而是在10天内陆续到达：

| 天数 | 到达订单数 | 订单编号 | 对应slot范围 |
|------|-----------|---------|-------------|
| 第1天 | 1个 | 订单16 | slot 1-6 |
| 第2天 | 2个 | 订单9, 15 | slot 7-12 |
| 第3天 | 2个 | 订单3, 5 | slot 13-18 |
| 第4天 | 2个 | 订单13, 17 | slot 19-24 |
| 第5天 | 4个 | 订单7, 8, 14, 19 | slot 25-30 |
| 第6天 | 1个 | 订单6 | slot 31-36 |
| 第7天 | 1个 | 订单2 | slot 37-42 |
| 第8天 | 1个 | 订单12 | slot 43-48 |
| 第9天 | 1个 | 订单20 | slot 49-54 |
| 第10天 | 5个 | 订单1, 4, 10, 11, 18 | slot 55-60 |

### 时间窗口

每个订单都有一个生产时间窗口 `[release_slot, due_slot]`：
- **最短窗口**: 2天（12个slot）
- **最长窗口**: 5天（30个slot）
- **平均窗口**: 约3-4天

### 示例订单

```csv
order_id,product,quantity,release_slot,due_slot,unit_price
16,1,270,3,35,53
```

**解读**：
- 订单16生产产品1
- 需求量270单位
- **到达时间**: slot 3（第1天早上8点后）
- **截止时间**: slot 35（第6天下午）
- **时间窗口**: 从slot 3到slot 35，共32个slot（约5.3天）
- 单价53元/单位

## 测试场景

### 1. 订单随机到达
- ✅ 第1天只能调度订单16（其他订单还未到达）
- ✅ 第2天可以调度订单16, 9, 15（新增订单9, 15）
- ✅ 第3天可以调度订单16, 9, 15, 3, 5（新增订单3, 5）
- ✅ 以此类推...

### 2. 滚动调度验证
每天早上8点，系统应该：
1. 计算当前起始slot
2. 只调度 `release_slot <= current_slot` 的订单
3. 忽略 `release_slot > current_slot` 的未来订单

### 3. 日志观察要点

运行调度时，日志应该显示：

```
第 1 天调度 - 早上8:00
📅 当前起始slot: 1 (第1天早上8点)
📦 订单池统计:
  - 总未完成订单: 20 个
  - 已到达可调度: 1 个 (release_slot <= 1)
  - 未来订单: 19 个 (release_slot > 1)
  - 订单池release_slot范围: [3, 3]

第 2 天调度 - 早上8:00
📅 当前起始slot: 7 (第2天早上8点)
📦 订单池统计:
  - 总未完成订单: 20 个
  - 已到达可调度: 3 个 (release_slot <= 7)
  - 未来订单: 17 个 (release_slot > 7)
  - 订单池release_slot范围: [3, 7]
```

### 4. 预期效果

- ✅ **订单逐步到达**: 不是所有订单都在第1天可见
- ✅ **滚动调度**: 每天只调度已到达的订单
- ✅ **时间窗口约束**: 订单只能在 `[release_slot, due_slot]` 内生产
- ✅ **罚款机制**: 部分订单可能因产能不足而延期，产生罚款

## 使用方法

### 命令行运行
```bash
python src/main.py --orders data/sample_orders_random.csv --days 15
```

### GUI运行
1. 启动GUI: `streamlit run gui_app.py`
2. 上传 `sample_orders_random.csv`
3. 设置模拟天数为15天
4. 点击"开始模拟"
5. 观察每天的订单池变化

## 与其他数据集的对比

| 数据集 | 订单数 | 到达模式 | 用途 |
|--------|--------|---------|------|
| `sample_orders_small.csv` | 20 | 部分第1天，部分随机 | 基础测试 |
| `delay.csv` | 20 | 前5天随机到达 | 延期测试 |
| `delay_full.csv` | 48 | 前5天随机到达 | 满负荷测试 |
| **`sample_orders_random.csv`** | **20** | **前10天随机到达** | **随机到达测试** |

## 注意事项

1. **时间跨度**: 建议模拟至少15天，以便观察所有订单的完整生命周期
2. **产能配置**: 使用默认产能配置（产品1:50, 产品2:60, 产品3:55）
3. **日志观察**: 重点关注"订单池统计"部分，验证订单到达逻辑
4. **罚款情况**: 部分订单可能因时间窗口较短或产能不足而产生罚款

---

**生成时间**: 2025-12-11  
**生成脚本**: `generate_random_arrival_orders.py`
