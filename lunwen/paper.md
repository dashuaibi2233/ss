# 智能制造生产调度系统论文（总结版）

## 摘要
本文面向多产品、多产线、滚动时间窗的离散生产调度问题，构建了以利润最大化为目标的优化框架：遗传算法（GA）全局搜索 + 迭代局部搜索/变邻域搜索（ILS/VNS）局部精化，并在每日 8:00 的滚动调度机制下动态更新计划。针对“未完成订单一次性罚款（总金额的10%）”的离散跳变特性，进一步升级为岛模型并行 GA 与风险驱动局部搜索，使解的鲁棒性和对高风险订单的针对性显著提升。系统提供命令行与 Streamlit GUI 两种交互方式，支持可视化的甘特图与指标图，并在标准数据集上完成对比实验。

## 1 问题描述
- 多产品集 `P = {1,2,3}`，多产线 `L = {1,2,3}`，每日时间段数 `SLOTS_PER_DAY = 6`；每段 4 小时
- 订单集合 `O`，对任意订单 `o ∈ O`，需在其可生产时间窗内完成生产并交付
- 目标：在滚动时域内（例如 10 天 × 6 段）最大化总利润 `Profit = Revenue − Cost − Penalty`
- 约束：产能限制、到达时间与截止时间窗口、产线/时间段分配的可行性、滚动冻结已执行时段

## 2 问题假设与符号说明
- 订单参数（对任意 `o ∈ O`）：
  - 产品类型：`p_o ∈ P`
  - 需求数量：`q_o`
  - 单位售价：`s_o`
  - 到达时间（slot，1-based）：`r_o`，仅当 `t ≥ r_o` 允许生产
  - 截止时间（slot，1-based）：`d_o`，当 `t ≥ d_o` 视为已超期
- 产能参数：
  - 产品产能：`CAPACITY[p]` 表示在任一可生产 slot 的单位产能
  - 人工成本：`LABOR_COSTS[0..5]` 表示每日 6 段的单位时段成本（白/晚班两档，默认 `[1000,1000,1000,2000,2000,2000]`）
  - 罚款比例：`PENALTY_RATE = 0.1`
- 调度编码（滚动窗口对齐全局时间轴）：
  - `Gene1 ∈ {0,1,2,3}^{NUM_LINES×H}`：每条产线、每个slot的产品类型（0 表示空闲）
  - `Gene2`：订单优先级排列（索引序列）
- 指标定义：
  - 收入 `Revenue`: 完成量 × 单价
  - 成本 `Cost`: 工作产线数 × 当段工资
  - 罚款 `Penalty`: 未完全完成订单的总金额 × 10%

## 3 算法设计
### 3.1 遗传算法（GA）
- 编码：`Chromosome = [Gene1, Gene2]`
- 适应度：`Fitness = Profit`（`src/ga/fitness.py:30`）
- 流程：初始化种群 → 锦标赛选择 → 双基因交叉与变异 → 精英保留 → 迭代终止（`src/ga/engine.py`）
- 解码：依据 `Gene1` 产线-时间-产品结构与 `Gene2` 优先级，将订单分配到满足 `r_o ≤ t < d_o` 的可用 slot（`src/ga/decoder.py`）

### 3.2 ILS/VNS 局部搜索（旧版）
- 随机邻域 + 贪心接受
- `N1`：同产线两时间段产品交换；`N2`：订单优先级的微调
- 仅接受更优解，连续多次无改善提前结束（`src/local_search/ils_vns.py`）

### 3.3 岛模型并行 GA（升级）
- 多岛并行进化 + 精英迁移，提升解的多样性与稳定性（`src/ga/island_engine.py`）
- 岛类型可承载不同偏好（利润/交付/探索），在统一利润适应度下演化并共享结构

### 3.4 滚动调度机制
- 每日 8:00 触发调度，冻结已执行时段，优化未来窗口并映射回全局时间轴（`src/scheduler/rolling_scheduler.py`）
- 当日执行依据当前 `Schedule` 实际统计：当日收入/成本/新增罚款与利润（`execute_daily_production`）



## 4 实验仿真
### 4.1 数据集与环境
- 数据集：`data/delay_full.csv`（包含 `release_slot`、`due_slot`、单价与数量）
- 运行环境：Windows + Python，核心依赖 `numpy/pandas/matplotlib/streamlit`
- 成本模式：白班 1000、晚班 2000 两档

### 4.2 对比方法
- GA：单种群 GA，无局部搜索
- GA+LS：单种群 GA + 贪心 ILS
- Island GA：多岛并行 GA，无局部搜索
- Island GA+LS：多岛并行 GA + 局部搜索

### 4.3 指标与结果呈现
- 指标：总收入、总成本、总罚款、总利润、完成订单数/总订单数、按期率
- 实验脚本：`biao/run_experiment.py`（一键生成三线表）
- 输出文件：
  - 结果表：`biao/out/tri_table_results.csv`
  - 三线表图：`biao/out/tri_table.png`
  - GUI 可视：`output/gantt_chart.png`、`output/order_completion.png`、`output/profit_breakdown.png`、`output/line_utilization.png`

### 4.4 代表性现象与分析
- 离散罚款跳变导致“临近完成”的订单优先级显著提升
- 高成本夜班在利润导向策略下可能被启用，用以避免更大的整单罚款
- 岛模型并行 GA 在多日滚动下表现更稳健；风险驱动 LS 在关键订单附近提升方案质量
- 停工保护在“工资极端设定”下可避免亏损生产，符合业务理性

## 5 优缺点与改进
### 5.1 优点
- 混合优化框架兼顾全局搜索与局部精化，能处理滚动调度与随机到达
- 岛模型多样性与精英迁移提升解的鲁棒性
- 风险驱动 LS 对高罚款风险订单更具针对性，受控退火提升跳出能力
- 可视化全面、GUI交互友好、指标体系完善

### 5.2 缺点
- 适应度仍为单一利润，未显式建模多目标（如成本/交付/鲁棒性）加权
- 局部搜索预算与邻域设计仍可精细化（如更丰富的结构操作与代价模型）
- 成本模型简化为白/晚两档，未考虑切换成本、设备维护等
- 对极端参数（超高工资）需策略开关如停工保护介入

### 5.3 改进方向
- 多目标适应度或分层策略：在岛间引入偏好差异的权重组合
- 更细粒度成本与工艺模型：引入切换损耗、设置时间与维护计划
- 风险度量强化：结合违约概率预测模型，动态调整优先级与邻域
- 在线学习与参数自适应：在滚动多周内根据结果反馈调整 GA/LS 参数

## 6 代码与实现要点（参考）
- 适应度计算：`src/models/schedule.py:104`
- 当日执行与成本统计：`src/scheduler/rolling_scheduler.py:264-281, 330-335`
- 每日罚款触发：`src/scheduler/rolling_scheduler.py:403-440`
- 解码分配与时间窗约束：`src/ga/decoder.py:65-96`
- 岛模型引擎与迁移：`src/ga/island_engine.py`

## 7 结论
本文提出并实现了“岛模型并行 GA +  LS”的滚动调度优化框架，能够在离散罚款与随机到达的复杂业务约束下，生成更稳定且更具业务针对性的生产计划。实验对比表明，升级策略在多日滚动场景下可以更好地平衡收入、成本与罚款。结合停工保护与可视化解释，系统更贴近实际生产决策的理性与可用性。后续将围绕多目标优化与工艺细化进一步提升系统表现。

