# GUI v2.0 使用说明 - 按天浏览模式

## 🎉 新功能概览

### 核心改进

1. **一次性运行完整周期**
   - 点击"开始模拟"后，系统会一次性运行完整个调度周期（如3天、5天）
   - 所有天的结果都会被保存，无需重复运行

2. **按天浏览结果**
   - 提供天数选择器，可以自由切换查看任意一天的结果
   - 支持"前一天/后一天"按钮快速导航
   - 支持下拉框直接跳转到指定天数

3. **详细的订单进度表**
   - 显示每个订单在当前天的完成情况
   - 包含：订单ID、产品类型、需求数量、累计完成、剩余数量、完成率、状态、按期情况
   - 实时统计已完成订单数、按期订单数、平均完成率

## 📖 使用流程

### 第一步：加载订单

1. 进入【📦 订单管理】标签页
2. 点击【📂 加载小规模示例】或上传自定义CSV
3. 确认订单加载成功

### 第二步：运行完整模拟

1. 进入【🚀 调度运行】标签页
2. 设置**模拟天数**（如3天）
3. 点击【▶️ 开始模拟（运行完整周期）】
4. 等待系统运行完整个周期（可能需要几十秒到几分钟）
5. 看到"✅ 完整X天调度周期运行完成"提示

### 第三步：按天浏览结果

1. 进入【📊 结果分析】标签页
2. 使用天数选择器：
   - **⬅️ 前一天** / **下一天 ➡️** 按钮：逐天浏览
   - **下拉框**：直接跳转到指定天数
3. 查看当前天的数据：
   - 💰 **当天财务指标**：收入、成本、罚款、利润
   - 📦 **订单进度表**：每个订单的详细进度
   - 📈 **累计统计**：整个周期的总体情况

## 🎯 界面说明

### 天数选择器

```
⬅️ 前一天  |  [第 X 天 ▼]  |  下一天 ➡️
```

- **前一天按钮**：查看前一天的结果（第1天时禁用）
- **下拉框**：显示当前天数，点击可选择其他天
- **下一天按钮**：查看后一天的结果（最后一天时禁用）

### 订单进度表

| 订单ID | 产品类型 | 需求数量 | 累计完成 | 剩余数量 | 完成率 | 状态 | 按期情况 | 截止时段 |
|--------|----------|----------|----------|----------|--------|------|----------|----------|
| 1 | 2 | 220 | 150 | 70 | 68.2% | ⏳ 进行中 | ✅ 按期 | 5 |
| 2 | 1 | 150 | 150 | 0 | 100.0% | ✅ 已完成 | ✅ 按期 | 6 |

**字段说明**：
- **订单ID**：订单编号
- **产品类型**：1/2/3
- **需求数量**：订单总量
- **累计完成**：截至当前天已完成的数量
- **剩余数量**：还需完成的数量
- **完成率**：累计完成 / 需求数量
- **状态**：✅ 已完成 / ⏳ 进行中
- **按期情况**：✅ 按期 / ⚠️ 延期（基于截止时段判断）
- **截止时段**：订单的截止时间段

### 统计卡片

显示三个关键统计：
- **已完成订单**：X/Y（X个已完成，共Y个订单）
- **按期订单**：X/Y（X个按期，共Y个订单）
- **平均完成率**：所有订单的平均完成百分比

## 🔍 数据结构说明

### SimulationResult

系统使用`SimulationResult`类存储完整模拟结果：

```python
simulation_result = {
    'num_days': 3,  # 模拟天数
    'days': {
        0: DayResult,  # 第1天的结果
        1: DayResult,  # 第2天的结果
        2: DayResult,  # 第3天的结果
    },
    'cumulative_stats': {  # 累计统计
        'total_revenue': 12345.0,
        'total_cost': 5678.0,
        'total_penalty': 123.0,
        'total_profit': 6544.0,
        'total_orders': 20,
        'completed_orders': 18,
        'daily_results': [...]
    }
}
```

### DayResult

每一天的结果包含：

```python
day_result = {
    'day_index': 0,  # 天数索引（0-based）
    'schedule': Schedule对象,  # 调度方案
    'orders': {  # 订单进度
        1: {
            'order_id': 1,
            'product': 2,
            'quantity': 220,
            'cumulative_produced': 150,
            'remaining': 70,
            'progress': 0.682,  # 68.2%
            'is_finished': False,
            'is_on_time': True,
            'due_slot': 5,
            'unit_price': 70
        },
        ...
    },
    'financial': {  # 当天财务
        'revenue': 4500.0,
        'cost': 1200.0,
        'penalty': 0.0,
        'profit': 3300.0
    }
}
```

## 💡 使用技巧

### 1. 对比不同天的进度

通过切换天数，可以观察：
- 订单完成进度的变化
- 每天的财务表现
- 哪些订单在哪天完成

### 2. 识别问题订单

在订单进度表中：
- 查找**完成率低**的订单
- 查找**⚠️ 延期**的订单
- 分析是否需要调整参数或订单优先级

### 3. 分析财务趋势

观察每天的财务指标：
- 收入是否稳定增长
- 成本是否控制合理
- 罚款主要发生在哪些天

### 4. 验证调度效果

- 运行多次不同参数的模拟
- 对比不同天数的结果
- 找到最优的参数配置

## ⚠️ 注意事项

### 1. 运行时间

完整周期运行时间取决于：
- 模拟天数（1-10天）
- 订单数量（20-100+）
- 算法参数（种群规模、迭代次数）

**建议**：
- 测试时使用小规模数据（20订单，3天）
- 正式运行使用中等规模（50订单，5-7天）

### 2. 内存占用

系统会保存所有天的完整数据，包括：
- 每天的调度方案
- 每个订单在每天的状态
- 每天的财务数据

**建议**：模拟天数不超过10天

### 3. 数据一致性

- 每次点击"开始模拟"会重置所有订单状态
- 切换天数只是浏览数据，不会重新运行算法
- 修改参数后需要重新运行完整模拟

## 🆚 与旧版本对比

| 功能 | 旧版本 | 新版本 v2.0 |
|------|--------|-------------|
| 运行方式 | 每次点击运行一天 | 一次运行完整周期 |
| 结果查看 | 只能看最新结果 | 可按天浏览所有结果 |
| 订单进度 | 只显示最终状态 | 显示每天的详细进度 |
| 数据保存 | 只保存累计数据 | 保存每天的完整数据 |
| 交互方式 | 需要多次点击 | 一次运行，自由浏览 |

## 🔧 技术实现

### 核心改动

1. **新增数据模型**
   - `SimulationResult`：存储完整模拟结果
   - `DayResult`：存储单日结果

2. **修改service.py**
   - `run_schedule`返回`SimulationResult`而不是简单的统计数据
   - 循环收集每天的订单进度和财务数据

3. **重构GUI**
   - 添加`simulation_result`和`current_day`状态
   - 实现天数选择器和导航按钮
   - 新增订单进度表组件

### 文件变更

- ✅ 新增：`src/models/simulation_result.py`
- ✅ 修改：`src/service.py`
- ✅ 修改：`gui_app.py`
- ✅ 备份：`gui_app_backup.py`

## 📞 反馈与支持

如有问题或建议，请查看：
- [GUI使用说明](GUI使用说明.md)
- [快速开始指南](QUICK_START_GUI.md)
- [项目README](../README.md)

---

**版本**: v2.0  
**更新日期**: 2025年12月11日  
**主要特性**: 完整周期模拟 + 按天浏览 + 订单进度追踪
