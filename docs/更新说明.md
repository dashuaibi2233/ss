# 文档更新说明

## 更新时间
2024年12月

## 更新内容总结

### 1. README.md
**更新内容：**
- ✅ 更新数据文件说明（20个订单）
- ✅ 详细的配置参数说明（GA参数、成本参数等）
- ✅ 完善的评价指标体系（财务、订单、生产三大类）
- ✅ 人工成本配置示例
- ✅ 罚款规则说明（订单总金额10%）

**关键更新：**
```python
# 人工成本配置
labor_costs_per_day = [100, 100, 115, 135, 150, 140]  # 6个slot/天

# 罚款规则
未完成订单罚款 = 订单总金额 × 10%
```

---

### 2. EXPERIMENT.md
**更新内容：**
- ✅ 更新GA参数（PopSize=30, MaxGen=50，演示用）
- ✅ 更新产能配置（产品1=50, 产品2=60, 产品3=55）
- ✅ 详细的人工成本配置（6个时段，越偏离正常时间成本越高）
- ✅ 小规模算例实际数据（20个订单，60个slot）
- ✅ 新增滚动调度测试章节
- ✅ 罚款规则公式说明

**关键更新：**

#### 人工成本（每天6个slot）
| 时段 | 时间 | 成本 | 说明 |
|------|------|------|------|
| Slot 1-2 | 8:00-16:00 | 100元 | 正常工作时间 |
| Slot 3 | 16:00-20:00 | 115元 | 开始偏离 |
| Slot 4 | 20:00-24:00 | 135元 | 晚班 |
| Slot 5 | 0:00-4:00 | 150元 | 深夜（最高） |
| Slot 6 | 4:00-8:00 | 140元 | 凌晨 |

#### 滚动调度测试
验证要点：
1. 订单状态更新（remaining递减）
2. 未完成订单数递减
3. 多日累计统计正确性
4. 冻结时段机制

---

### 3. 设计大纲.md
**状态：** 已是最新版本，无需更新

核心内容：
- ✅ 问题描述与建模
- ✅ 数学模型（罚款规则已正确）
- ✅ 算法设计（GA + ILS/VNS + 滚动调度）
- ✅ 实验方案

---

### 4. ALGORITHM.md
**状态：** 已是最新版本，无需更新

核心内容：
- ✅ 染色体编码（Gene1 + Gene2）
- ✅ 解码策略（贪心分配）
- ✅ 遗传操作（选择、交叉、变异）
- ✅ 局部搜索（ILS/VNS）
- ✅ 滚动调度机制

---

## 关键实现细节

### 罚款规则
```python
# 如果订单未完全完成，罚款 = 订单总金额 × 10%
if order.remaining > 0:
    penalty = order.quantity * order.unit_price * 0.1
```

### 成本计算
```python
# 统计工作的(产线, 时段)组合
for (line, slot) in working_slots:
    cost += labor_costs[slot - 1]  # slot是1-based
```

### 滚动调度
```python
# 每天执行：
1. 优化未来时段
2. 执行当天生产（更新order.remaining）
3. 累计统计数据
4. 冻结已执行时段
```

---

## 实际运行结果示例

### 3天滚动调度
```
Day 1: 待处理 20个 (未完成: 20个)
  收入=¥176,345, 成本=¥6,660, 罚款=¥4,365, 利润=¥165,320
  完成订单: 15/20

Day 2: 待处理 20个 (未完成: 5个)  ← 减少了！
  收入=¥116,030, 成本=¥4,440, 罚款=¥7,388, 利润=¥104,202
  完成订单: 10/20

Day 3: 待处理 20个 (未完成: 3个)  ← 继续减少
  收入=¥23,100, 成本=¥900, 罚款=¥8,458, 利润=¥13,742
  完成订单: 3/20

最终汇总（多日累计）:
  总收入: ¥315,475 = 176,345 + 116,030 + 23,100
  总成本: ¥12,000 = 6,660 + 4,440 + 900
  总罚款: ¥20,211 = 4,365 + 7,388 + 8,458
  总利润: ¥283,264 = 315,475 - 12,000 - 20,211
  完成订单: 13/20 (65%)
```

---

## 配置文件位置

### 主要配置
- **GA参数**: `src/main.py` 第51-56行
- **人工成本**: `src/main.py` 第46-49行
- **产能配置**: `src/config.py` 第32-36行
- **罚款比例**: `src/config.py` 第28行

### 数据文件
- **订单数据**: `data/sample_orders_small.csv`
- **格式**: `order_id,product,quantity,due_slot,unit_price`

---

## 可视化输出

系统生成4类图表（全中文）：
1. **甘特图** (`gantt_chart.png`)
   - 标题：生产调度甘特图
   - X轴：时间段
   - Y轴：生产线（产线1、产线2、产线3）

2. **利润分解图** (`profit_breakdown.png`)
   - 收入、成本、罚款、利润

3. **订单完成图** (`order_completion.png`)
   - 已完成、部分完成、未开始

4. **产线利用率图** (`line_utilization.png`)
   - 产线1、产线2、产线3的利用率

---

## 验证清单

- [x] 罚款规则正确（订单总金额10%）
- [x] 人工成本配置正确（6个时段，梯度递增）
- [x] 滚动调度状态更新正确（remaining递减）
- [x] 多日累计统计正确（收入/成本/罚款求和）
- [x] 所有输出中文化（print语句、图表标签）
- [x] 文档与代码一致

---

## 后续建议

### 可选扩展
1. **中等规模算例**：创建50-100个订单的测试数据
2. **参数敏感性分析**：测试不同GA参数对结果的影响
3. **对比算法**：实现EDD基准算法进行对比
4. **性能优化**：针对大规模问题优化算法效率

### 论文撰写
所有文档已准备就绪，可直接用于：
- 第2章：问题描述与建模（设计大纲.md 第2章）
- 第3章：算法设计（ALGORITHM.md）
- 第4章：实验设计（EXPERIMENT.md）
- 第5章：实验结果（运行main.py获取）
