# GUI 使用说明

## 概述

智能制造生产调度系统提供了基于 Streamlit 的可视化 GUI 界面，支持配置管理、订单上传、调度运行和结果分析等完整功能。

## 启动方式

### 1. 安装依赖

确保已安装所有必需的依赖包：

```bash
pip install -r requirements.txt
```

主要GUI依赖：
- `streamlit>=1.28.0` - Web应用框架
- `plotly>=5.14.0` - 交互式图表库

### 2. 启动GUI

在项目根目录执行：

```bash
streamlit run gui_app.py
```

启动成功后，浏览器会自动打开，或手动访问显示的URL（通常是 `http://localhost:8501`）。

## 界面布局

### 侧边栏 - 快速配置

侧边栏提供常用参数的快速调整：

#### 遗传算法参数
- **种群规模** (10-100): 每代个体数量，越大搜索越全面但速度越慢
- **最大迭代次数** (10-200): GA的进化代数
- **交叉概率** (0.0-1.0): 染色体交叉的概率
- **变异概率** (0.0-1.0): 基因变异的概率
- **精英个体数** (1-10): 每代保留的最优个体数

#### 局部搜索参数
- **最大迭代次数** (10-100): 局部搜索的迭代次数

#### 操作按钮
- **💾 应用配置**: 保存当前参数设置
- **🔄 重置为默认**: 恢复系统默认配置

### 主界面 - 四个标签页

## 标签页 1: 📋 配置详情

显示系统的完整配置信息。

### 生产线配置
- 生产线数量
- 产品种类
- 每天时间段数

### 产能配置
以表格形式展示各产品的产能限制（单位/时间段）。

### 算法参数
- 遗传算法参数详情
- 局部搜索参数详情
- 成本参数（违约罚款比例）

### 配置导入/导出
- **📥 导出配置(JSON)**: 将当前配置导出为JSON文件，便于保存和分享

## 标签页 2: 📦 订单管理

管理生产订单数据。

### 上传订单CSV

支持上传自定义订单数据：

**CSV格式要求**：
```csv
order_id,product,quantity,due_slot,unit_price
1,2,220,5,70
2,1,150,6,50
...
```

字段说明：
- `order_id`: 订单编号（唯一）
- `product`: 产品类型（1-3）
- `quantity`: 订单数量
- `due_slot`: 截止时段（slot编号，每天6个时段）
- `unit_price`: 单位价格（元/单位）

### 使用示例数据

提供两个预置数据集：
- **📂 加载小规模示例**: 约20个订单，适合快速测试
- **📂 加载中等规模示例**: 约50个订单，适合性能测试

### 订单概览

加载订单后显示：
- **统计卡片**: 总订单数、待处理订单、已完成订单、完成率
- **订单详情表格**: 显示前20个订单的详细信息
  - 订单ID、产品ID、数量、截止日期、收入、状态

## 标签页 3: 🚀 调度运行

执行生产调度算法。

### 运行参数

- **模拟天数** (1-10): 设置要模拟的生产天数
  - 每天早上8点执行一次调度
  - 支持滚动调度机制

### 运行调度

点击 **▶️ 运行调度** 按钮开始：
1. 系统调用遗传算法进行全局优化
2. 使用局部搜索进行精细调整
3. 生成完整的生产计划
4. 自动生成可视化图表

### 运行状态

调度完成后显示：

#### 💰 财务指标
- **总收入**: 所有完成订单的收入总和
- **总成本**: 人工成本累计
- **总罚款**: 未完成订单的违约罚款
- **总利润**: 收入 - 成本 - 罚款

#### 📦 订单指标
- **总订单数**: 系统中的订单总数
- **完成订单数**: 完全完成的订单数量
- **完成率**: 完成订单占比

#### 📅 每日明细
以表格形式展示每天的收入、成本、罚款和利润。

## 标签页 4: 📊 结果分析

查看和下载调度结果的可视化图表。

### 生产甘特图

展示完整的生产计划：
- **横轴**: 时间段（每段4小时）
- **纵轴**: 生产线（Line 1-3）
- **颜色**: 不同产品类型
- **标注**: 订单ID和生产数量

### 利润分解图

饼图展示利润构成：
- 总收入
- 总成本
- 总罚款
- 净利润

### 订单完成情况

柱状图展示：
- 完成订单数 vs 未完成订单数
- 按期完成 vs 延期完成

### 产线利用率

柱状图展示各生产线的工作时段占比。

### 下载结果

提供四个下载按钮：
- **下载甘特图**: gantt_chart.png
- **下载利润图**: profit_breakdown.png
- **下载订单图**: order_completion.png
- **下载利用率图**: line_utilization.png

## 使用流程示例

### 快速开始（3步）

1. **加载订单**
   - 进入【📦 订单管理】标签页
   - 点击【📂 加载小规模示例】

2. **运行调度**
   - 进入【🚀 调度运行】标签页
   - 设置模拟天数为 3
   - 点击【▶️ 运行调度】

3. **查看结果**
   - 进入【📊 结果分析】标签页
   - 查看甘特图和各项指标
   - 下载需要的图表

### 高级使用

#### 调整算法参数

1. 在侧边栏修改GA参数（如增大种群规模到50）
2. 点击【💾 应用配置】
3. 重新运行调度，对比结果

#### 使用自定义订单

1. 准备符合格式的CSV文件
2. 在【📦 订单管理】中上传
3. 运行调度并分析结果

#### 配置保存与复用

1. 在【📋 配置详情】中调整参数
2. 点击【📥 导出配置(JSON)】保存
3. 下次可通过修改代码导入配置

## 性能优化建议

### 快速测试
- 种群规模: 20-30
- 最大迭代次数: 30-50
- 局部搜索迭代: 10-20
- 模拟天数: 1-3

### 高质量结果
- 种群规模: 50-100
- 最大迭代次数: 100-200
- 局部搜索迭代: 50-100
- 模拟天数: 5-10

## 常见问题

### Q1: 调度运行时间过长？
**A**: 减小种群规模和迭代次数，或减少模拟天数。

### Q2: 利润为负值？
**A**: 可能是订单截止时间过紧或产能不足，尝试：
- 调整订单数据
- 增加模拟天数
- 优化算法参数

### Q3: 图表未显示？
**A**: 确保调度已成功运行，检查 `output/` 目录是否有生成的PNG文件。

### Q4: CSV上传失败？
**A**: 检查CSV格式是否正确，确保包含所有必需字段且数据类型正确。

### Q5: 多次运行后订单状态异常？
**A**: 系统会在每次运行调度前自动重置所有订单状态，确保每次运行都是从初始状态开始。如果看到订单显示"已完成"，那是上次运行的结果，再次点击"运行调度"会自动重置。

## 技术架构

### 前端框架
- **Streamlit**: 快速构建数据应用
- **Plotly**: 交互式图表（未来可扩展）

### 后端服务
- **service.py**: 封装核心调度逻辑
  - `load_default_config()`: 配置加载
  - `load_orders()`: 订单加载
  - `run_schedule()`: 调度执行

### 状态管理
使用 `st.session_state` 管理：
- `config`: 系统配置
- `orders`: 订单管理器
- `scheduler`: 调度器实例
- `stats`: 统计数据
- `output_dir`: 输出目录

## 扩展功能（未来）

- [ ] 实时调度进度显示
- [ ] 交互式甘特图（Plotly）
- [ ] 多方案对比分析
- [ ] 参数自动调优
- [ ] 历史记录管理
- [ ] 导出完整报告（PDF）

## 反馈与支持

如有问题或建议，请查看项目文档或联系开发团队。
